# 手动触发APK构建指南\n\n## 概述\n本指南将帮助您使用GitHub Actions手动触发APK构建流程。\n\n## 新功能\n✅ **已修复编译失败问题**：升级Node.js到20版本，优化平台添加逻辑\n✅ **已修复SVG图标格式问题**：自动转换SVG到PNG格式，确保Android兼容性\n\n## 操作步骤\n\n### 1. 访问工作流页面\n打开GitHub Actions工作流页面：\n🔗 [手动APK构建工作流](https://github.com/shen115/MigrantWorkerApp-CloudBuild/actions/workflows/manual-apk-build.yml)\n\n### 2. 运行工作流\n点击页面上的绿色 **\"Run workflow\"** 按钮\n\n### 3. 配置构建参数\n在弹出的对话框中配置以下参数：\n\n#### 构建类型 (Build Type)\n- **release** (推荐) - 发布版本，包含代码混淆和优化\n- **debug** - 调试版本，包含调试信息\n\n#### 构建环境 (Environment)\n- **production** (推荐) - 生产环境\n- **development** - 开发环境\n- **testing** - 测试环境\n\n### 4. 启动构建\n配置完成后，点击 **\"Run workflow\"** 按钮启动构建流程\n\n## 构建过程监控\n\n### 构建时间线\n- **总构建时间**: 10-15分钟\n- **依赖安装**: 2-3分钟\n- **图标格式验证**: 1分钟\n- **APK生成**: 8-12分钟\n- **文件上传**: 1-2分钟\n\n### 状态监控\n您可以在工作流运行页面实时监控构建状态：\n- 🟡 **排队中** - 等待GitHub Actions运行器\n- 🔵 **运行中** - 正在执行构建步骤\n- ✅ **成功** - APK构建成功\n- ❌ **失败** - 构建失败，需要检查日志\n\n## 获取构建结果\n\n### 成功构建\n构建成功后，您可以在以下位置获取APK文件：\n\n1. **GitHub Actions页面** - 在对应的工作流运行详情页\n2. **Artifacts** - 自动上传的构建产物\n3. **构建日志** - 详细的构建过程和输出信息\n\n### 构建产物\n- **APK文件**: `app-{build_type}-apk`\n- **构建日志**: `build-log-{build_type}`\n- **所有输出**: `all-build-outputs-{build_type}`\n\n## 常见问题解决\n\n### 🔧 编译失败问题\n\n#### 问题1：平台已存在错误\n**症状**: `CordovaError: Platform android already added.`\n**解决方案**: ✅ 已修复 - 工作流现在会自动检测并移除已存在的平台\n\n#### 问题2：Node.js版本不兼容\n**症状**: `cordova-android@14.0.1 requires node: '>=20.5.0'`\n**解决方案**: ✅ 已修复 - 工作流已升级到Node.js 20\n\n#### 问题3：SVG图标格式错误\n**症状**: `The file name must end with .xml or .png`\n**解决方案**: ✅ 已修复 - 工作流自动检测并转换SVG图标到PNG格式\n\n#### 问题4：构建超时\n**症状**: 构建过程长时间无响应\n**解决方案**: \n- 检查网络连接状态\n- 重新运行工作流\n- 选择debug模式进行详细日志输出\n\n### 🔍 调试建议\n\n1. **查看详细日志**: 在构建参数中选择debug模式\n2. **检查依赖**: 确保所有必需的插件和平台都已正确安装\n3. **验证配置**: 检查config.xml和package.json文件的配置\n4. **图标格式**: 确保图标文件格式正确（推荐使用PNG格式）\n\n## 技术支持\n\n如遇到构建问题，请：\n\n1. 检查GitHub Actions的构建日志\n2. 查看构建产物的详细输出\n3. 重新运行工作流进行验证\n4. 根据错误信息进行针对性修复\n\n## 注意事项\n\n- 每次构建都会生成新的APK文件\n- 构建产物会保留7天\n- 建议在正式发布前进行充分的测试\n- 生产环境构建请使用release模式\n- 图标文件建议使用PNG格式以确保兼容性\n\n---\n\n**最后更新**: 2025年9月19日\n**版本**: v2.1 - 修复SVG图标格式问题，添加自动格式转换