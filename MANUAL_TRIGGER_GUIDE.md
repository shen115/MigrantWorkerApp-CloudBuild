# 手动触发APK构建指南

## 概述
本指南将帮助您使用GitHub Actions手动触发APK构建流程。

## 新功能
✅ **已修复编译失败问题**：升级Node.js到20版本，优化平台添加逻辑

## 操作步骤

### 1. 访问工作流页面
打开GitHub Actions工作流页面：
🔗 [手动APK构建工作流](https://github.com/shen115/MigrantWorkerApp-CloudBuild/actions/workflows/manual-apk-build.yml)

### 2. 运行工作流
点击页面上的绿色 **"Run workflow"** 按钮

### 3. 配置构建参数
在弹出的对话框中配置以下参数：

#### 构建类型 (Build Type)
- **release** (推荐) - 发布版本，包含代码混淆和优化
- **debug** - 调试版本，包含调试信息

#### 构建环境 (Environment)
- **production** (推荐) - 生产环境
- **development** - 开发环境
- **testing** - 测试环境

### 4. 启动构建
配置完成后，点击 **"Run workflow"** 按钮启动构建流程

## 构建过程监控

### 构建时间线
- **总构建时间**: 10-15分钟
- **依赖安装**: 2-3分钟
- **APK生成**: 8-12分钟
- **文件上传**: 1-2分钟

### 状态监控
您可以在工作流运行页面实时监控构建状态：
- 🟡 **排队中** - 等待GitHub Actions运行器
- 🔵 **运行中** - 正在执行构建步骤
- ✅ **成功** - APK构建成功
- ❌ **失败** - 构建失败，需要检查日志

## 获取构建结果

### 成功构建
构建成功后，您可以在以下位置获取APK文件：

1. **GitHub Actions页面** - 在对应的工作流运行详情页
2. **Artifacts** - 自动上传的构建产物
3. **构建日志** - 详细的构建过程和输出信息

### 构建产物
- **APK文件**: `app-{build_type}-apk`
- **构建日志**: `build-log-{build_type}`
- **所有输出**: `all-build-outputs-{build_type}`

## 常见问题解决

### 🔧 编译失败问题

#### 问题1：平台已存在错误
**症状**: `CordovaError: Platform android already added.`
**解决方案**: ✅ 已修复 - 工作流现在会自动检测并移除已存在的平台

#### 问题2：Node.js版本不兼容
**症状**: `cordova-android@14.0.1 requires node: '>=20.5.0'`
**解决方案**: ✅ 已修复 - 工作流已升级到Node.js 20

#### 问题3：构建超时
**症状**: 构建过程长时间无响应
**解决方案**: 
- 检查网络连接状态
- 重新运行工作流
- 选择debug模式进行详细日志输出

### 🔍 调试建议

1. **查看详细日志**: 在构建参数中选择debug模式
2. **检查依赖**: 确保所有必需的插件和平台都已正确安装
3. **验证配置**: 检查config.xml和package.json文件的配置

## 技术支持

如遇到构建问题，请：

1. 检查GitHub Actions的构建日志
2. 查看构建产物的详细输出
3. 重新运行工作流进行验证
4. 根据错误信息进行针对性修复

## 注意事项

- 每次构建都会生成新的APK文件
- 构建产物会保留7天
- 建议在正式发布前进行充分的测试
- 生产环境构建请使用release模式

---

**最后更新**: 2025年9月19日
**版本**: v2.0 - 修复编译失败问题，升级Node.js版本